<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>C Client SDK for IBM Watson™ IoT: Device Development</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<div class="header">
<div class="headertitle">
<div class="title">C Client SDK for IBM Watson™ IoT </div>
<div class="contents"> <div class="textblock">
<p><a href="https://travis-ci.org/ibm-watson-iot/iot-c"><img alt="Build Status" src="https://travis-ci.org/ibm-watson-iot/iot-c.svg?branch=master" /></a>
<a href="https://github.com/ibm-watson-iot/iot-c/issues"><img alt="GitHub issues" src="https://img.shields.io/github/issues/ibm-watson-iot/iot-c.svg" /></a>
<a href="https://github.com/ibm-watson-iot/iot-c/blob/master/LICENSE"><img alt="GitHub" src="https://img.shields.io/github/license/ibm-watson-iot/iot-c.svg" /></a></p>
</div> </div>
</div><!--header-->
</div> </div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('iotpdevice.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Device Development </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>IoTP C Client SDK includes a shared library <code>libiotp-as-device.so</code> that exposes functions to build device client that runs on IoT devices. The device client connects to the IBM Watson™ IoT Platform (WIoTP) service, and sends events to WIoTP service or receive commands from WIoTP service.</p>
<p>The following sections describe on how to configure, connect, send events, receive commands, disconnect and cleanup, a device client.</p>
<h3>Configure Device</h3>
<p>To use the device client, you need to create a device handle or instance of this client. Use the following steps to create a device handle:</p>
<ul>
<li>Include <code>iot_device.h</code> header file in the device client code.</li>
<li><p class="startli">Create a device configuration object <a class="el" href="iotp__config_8h.html#a07c19b2785d306118690c545f79e7df8">IoTPConfig</a>, using one of the following options:</p><ol type="1">
<li>By reading the configuration items from a file using <a class="el" href="iotp__config_8h.html#afa887d5deaf76130df8cf6fe429be55f">IoTPConfig_create()</a>.</li>
<li>From environment variables using <a class="el" href="iotp__config_8h.html#a86516ef3c44bc07caeed7e0e60bf25d1">IoTPConfig_readEnvironment()</a>.</li>
<li>Setting configuration items using <a class="el" href="iotp__config_8h.html#a42af73c5e2142f28e975ad1a2a731931">IoTPConfig_setProperty()</a>.</li>
</ol>
<p class="startli">For details on configuration items and options, refer to <a href="./iotpconfig.html">Configuration</a>. If <code>IoTPConfig</code> is created successfully, on exit you must call <a class="el" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear()</a> to clear configuration object.</p>
</li>
<li>Create a device handle. A valid device handle <a class="el" href="iotp__device_8h.html#ab8aa7f6501af6d3fc767fbcb398529a5">IoTPDevice</a>, is available following a successful call to <a class="el" href="iotp__device_8h.html#a05a46909270881d73b418147e27bf247">IoTPDevice_create()</a>. If <code>IoTPDevice</code> handle is created successfully, on exit you must call <a class="el" href="iotp__device_8h.html#a8fa1e11d38b6d38ce4f3a3d35f2623a7">IoTPDevice_destroy()</a> to destroy the handle.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Though there are no restrictions on how many device clients, a device application can create, it is a good practice to not to create many clients to limit the number of connections to WIoTP service, and reduce load on the WIoTP service.</dd></dl>
<p>Sample code to configure a device client: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iotp__device_8h.html">iotp_device.h</a>&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9">IOTPRC</a> rc = IOTP_SUCCESS;</div><div class="line">    <a class="code" href="iotp__config_8h.html#a07c19b2785d306118690c545f79e7df8">IoTPConfig</a> *config = NULL;</div><div class="line">    <a class="code" href="iotp__device_8h.html#ab8aa7f6501af6d3fc767fbcb398529a5">IoTPDevice</a> *device = NULL;</div><div class="line">    <span class="comment">// Create IoTPConfig object using configuration options defined in the configuration file.</span></div><div class="line">    rc = <a class="code" href="iotp__config_8h.html#afa887d5deaf76130df8cf6fe429be55f">IoTPConfig_create</a>(&amp;config, <span class="stringliteral">&quot;configFilePath&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        exit(1);</div><div class="line">    }</div><div class="line">    <span class="comment">// Create IoTPDevice object</span></div><div class="line">    rc = <a class="code" href="iotp__device_8h.html#a05a46909270881d73b418147e27bf247">IoTPDevice_create</a>(&amp;device, config);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <a class="code" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear</a>(config);</div><div class="line">        exit(1);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Add code to connect, send event or receive commands</span></div><div class="line"></div><div class="line">    <span class="comment">// On exit call cleanup APIs</span></div><div class="line">    <a class="code" href="iotp__device_8h.html#a8fa1e11d38b6d38ce4f3a3d35f2623a7">IoTPDevice_destroy</a>(device);</div><div class="line">    <a class="code" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear</a>(config);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3>Connect Device</h3>
<p>You can connect a device client to WIoTP service using <a class="el" href="iotp__device_8h.html#a7a6facee6d516c9381d82a45f30b60fa">IoTPDevice_connect()</a>. This will allow the device client to send events, or receive commands. If device client is connected to WIoTP service successfully, on exit you must call <a class="el" href="iotp__device_8h.html#af1c5bceae570ccb81e3a25e27c797313">IoTPDevice_disconnect()</a> to disconnect the device client.</p>
<p>Sample code to connect a device client: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iotp__device_8h.html">iotp_device.h</a>&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9">IOTPRC</a> rc = <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a>;</div><div class="line"></div><div class="line">    <span class="comment">// Add code to configure the device client</span></div><div class="line"></div><div class="line">    <span class="comment">// Connect device</span></div><div class="line">    rc = <a class="code" href="iotp__device_8h.html#a7a6facee6d516c9381d82a45f30b60fa">IoTPDevice_connect</a>(device);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <span class="comment">// User defined code to handle connection failures, for example wait</span></div><div class="line">        <span class="comment">// for some time and retry connection. Or on exit invoke cleanup APIs.</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Add code to send event or receive commands</span></div><div class="line"></div><div class="line">    <span class="comment">// On exit call cleanup APIs</span></div><div class="line">    <a class="code" href="iotp__device_8h.html#af1c5bceae570ccb81e3a25e27c797313">IoTPDevice_disconnect</a>(device);</div><div class="line">    <a class="code" href="iotp__device_8h.html#a8fa1e11d38b6d38ce4f3a3d35f2623a7">IoTPDevice_destroy</a>(device);</div><div class="line">    <a class="code" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear</a>(config);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h3>Send Event</h3>
<p>Device can provide various types of information, for example data collected by the device (telemetry data), current status of the device etc. Events are the mechanism by which devices publish data to WIoTP service. Devices control the content of their messages, and assign a name for each event that is sent. WIoTP service uses the credentials that are attached to each event received to determine which device sent the event. This architecture prevents devices from impersonating one another.</p>
<p>Events can be published with any of the three quality of service (QoS) levels that are defined by the MQTT protocol. By default, events are published with a QoS level of 0. Optionally you can send MQTT V5 properties. For details on MQTT V5 properties, refer to &lt;a href="https://www.eclipse.org/paho/files/mqttdoc/MQTTAsync/html/struct_m_q_t_t_properties.html" target="_blank"}MQTTProperties.</p>
<p>To send an event to WIoTP service, you can use <a class="el" href="iotp__device_8h.html#affe396befc3638498ef9afe9a4f55982">IoTPDevice_sendEvent()</a>.</p>
<p>Sample code to send event (in JSON format) and no MQTT V5 properties: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iotp__device_8h.html">iotp_device.h</a>&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9">IOTPRC</a> rc = <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a>;</div><div class="line"></div><div class="line">    <span class="comment">// Add code to configure and connect the device client</span></div><div class="line"></div><div class="line">    <span class="comment">// Sample event data in json format</span></div><div class="line">    <span class="keywordtype">char</span> *data = <span class="stringliteral">&quot;{\&quot;d\&quot; : {\&quot;SensorID\&quot;: \&quot;Test\&quot;, \&quot;Reading\&quot;: 7 }}&quot;</span>;</div><div class="line">    <span class="comment">// Send status event with QoS0 and no MQTT properties</span></div><div class="line">    rc = <a class="code" href="iotp__device_8h.html#affe396befc3638498ef9afe9a4f55982">IoTPDevice_sendEvent</a>(device,<span class="stringliteral">&quot;status&quot;</span>, data, <span class="stringliteral">&quot;json&quot;</span>, QoS0, NULL);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <span class="comment">// User defined code to handle send failures. Or on exit invoke cleanup APIs.</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Add code to receive and process commands, if required</span></div><div class="line"></div><div class="line">    <span class="comment">// On exit call cleanup APIs</span></div><div class="line">    <a class="code" href="iotp__device_8h.html#af1c5bceae570ccb81e3a25e27c797313">IoTPDevice_disconnect</a>(device);</div><div class="line">    <a class="code" href="iotp__device_8h.html#a8fa1e11d38b6d38ce4f3a3d35f2623a7">IoTPDevice_destroy</a>(device);</div><div class="line">    <a class="code" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear</a>(config);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Sample code to send event (in JSON format) and MQTT V5 properties: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iotp__device_8h.html">iotp_device.h</a>&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9">IOTPRC</a> rc = <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a>;</div><div class="line"></div><div class="line">    <span class="comment">// Add code to configure and connect the device client</span></div><div class="line"></div><div class="line">    <span class="comment">// Set MQTT V5 properties</span></div><div class="line">    MQTTProperties *properties = (MQTTProperties *)malloc(<span class="keyword">sizeof</span> MQTTProperties);</div><div class="line">    MQTTProperty   property;</div><div class="line">    <span class="keyword">property</span>.identifier = MQTTPROPERTY_CODE_USER_PROPERTY;</div><div class="line">    <span class="keyword">property</span>.value.data.data = <span class="stringliteral">&quot;user defined property&quot;</span>;</div><div class="line">    <span class="keyword">property</span>.value.data.len = (int)strlen(property.value.data.data);</div><div class="line">    <span class="keyword">property</span>.value.value.data = <span class="stringliteral">&quot;user defined property value&quot;</span>;</div><div class="line">    <span class="keyword">property</span>.value.value.len = (int)strlen(property.value.value.data);</div><div class="line">    rc = MQTTProperties_add(properties, &amp;property);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <span class="comment">// User defined code to handle failure. Or on exit invoke cleanup APIs.</span></div><div class="line">    }</div><div class="line">    <span class="comment">// Sample event data in json format</span></div><div class="line">    <span class="keywordtype">char</span> *data = <span class="stringliteral">&quot;{\&quot;d\&quot; : {\&quot;SensorID\&quot;: \&quot;Test\&quot;, \&quot;Reading\&quot;: 7 }}&quot;</span>;</div><div class="line">    <span class="comment">// Send status event with QoS0 and no MQTT properties</span></div><div class="line">    rc = <a class="code" href="iotp__device_8h.html#affe396befc3638498ef9afe9a4f55982">IoTPDevice_sendEvent</a>(device,<span class="stringliteral">&quot;status&quot;</span>, data, <span class="stringliteral">&quot;json&quot;</span>, QoS0, properties);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <span class="comment">// User defined code to handle failure. Or on exit invoke cleanup APIs.</span></div><div class="line">    }</div><div class="line">    <span class="comment">// Free MQTT V5 properties</span></div><div class="line">    MQTTProperties_free(properties);</div><div class="line"></div><div class="line">    <span class="comment">// Add code to receive commands and process, if required</span></div><div class="line"></div><div class="line">    <span class="comment">// On exit call cleanup APIs</span></div><div class="line">    <a class="code" href="iotp__device_8h.html#af1c5bceae570ccb81e3a25e27c797313">IoTPDevice_disconnect</a>(device);</div><div class="line">    <a class="code" href="iotp__device_8h.html#a8fa1e11d38b6d38ce4f3a3d35f2623a7">IoTPDevice_destroy</a>(device);</div><div class="line">    <a class="code" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear</a>(config);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Device can collect large amount of data. Depending on the use case, users will have to predict which data provides the most value. They can predict this based on impact of data collection, power consumption of the device, and data transmission speed and latency, how the data is consumed by back-end applications. Users will also have to decide on how to represent the event from devices. Sometimes it is difficult to decide what constitutes a device. For example, a commercial refrigeration units (used in departmental stores) may have multiple bins or compartments with temperature sensors in each of the compartments. In this case, each compartment can be modeled as a device with its own unique device ID or the whole unit could be one device with temperature data from each compartment. So, events could be modeled as different levels of abstraction. Some of the examples could be:</dd>
<dd>
<b>Example 1:</b> Modeled as each temperature sensor as a device: <div class="fragment"><div class="line">{<span class="stringliteral">&quot;deviceId&quot;</span>:<span class="stringliteral">&quot;refUnit1_compartment1&quot;</span>,<span class="stringliteral">&quot;temp&quot;</span>:18}</div><div class="line">{<span class="stringliteral">&quot;deviceId&quot;</span>:<span class="stringliteral">&quot;refunit1_compartment2&quot;</span>,<span class="stringliteral">&quot;temp&quot;</span>:20}</div></div><!-- fragment --></dd>
<dd>
<b>Example 2:</b> Modeled as refrigeration unit as a device: <div class="fragment"><div class="line">{<span class="stringliteral">&quot;deviceId&quot;</span>:<span class="stringliteral">&quot;refunit1&quot;</span>,<span class="stringliteral">&quot;compartment1_temp&quot;</span>:18, <span class="stringliteral">&quot;compartment2_temp&quot;</span>:20}</div></div><!-- fragment --></dd>
<dd>
<b>Example 3:</b> Modeled as refrigeration unit as a device and temp data in an array: <div class="fragment"><div class="line">{<span class="stringliteral">&quot;deviceId&quot;</span>:<span class="stringliteral">&quot;refunit1&quot;</span>,<span class="stringliteral">&quot;compartments&quot;</span>:[{<span class="stringliteral">&quot;temp&quot;</span>:18},{<span class="stringliteral">&quot;temp&quot;</span>:20}]}</div></div><!-- fragment --></dd>
<dd>
Considering the size of event, and consumbility by back-end application, Example 3 is a better option to use compared with Example 1 and Example 2.</dd></dl>
<h3>Receive Command</h3>
<p>Commands are the mechanism by which applications communicate with devices. Only applications can send commands, and the commands are sent to specific devices. The device must determine which action to take on receipt of any given command. The device client must register a callback function to process the received command.</p>
<p>There are two ways to register a callback and subscribe to commands:</p>
<ol type="1">
<li>A device client can subscribe to commands using <a class="el" href="iotp__device_8h.html#a5c500f40abdc10973c7a55445c59d5dc">IoTPDevice_subscribeToCommands()</a>. To process received commands, you must register a command callback. Use <a class="el" href="iotp__device_8h.html#a77c28a7752929c488f8de1d757faa161">IoTPDevice_setCommandsHandler()</a> to set command callback or handler for all commands.</li>
<li>You can also use <a class="el" href="iotp__device_8h.html#a99676449ab0c70b3960c8f2fecf68ee6">IoTPDevice_setCommandHandler()</a> to register a command callback and subscribe to a specific command.</li>
</ol>
<p>Sample code to receive commands by a device client: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="iotp__device_8h.html">iotp_device.h</a>&gt;</span></div><div class="line"><span class="keywordtype">void</span>  deviceCommandCallback (<span class="keywordtype">char</span>* type, <span class="keywordtype">char</span>* <span class="keywordtype">id</span>, <span class="keywordtype">char</span>* commandName, <span class="keywordtype">char</span> *format, <span class="keywordtype">void</span>* payload, <span class="keywordtype">size_t</span> payloadSize)</div><div class="line">{</div><div class="line">    fprintf(stdout, <span class="stringliteral">&quot;Received device command:\n&quot;</span>);</div><div class="line">    fprintf(stdout, <span class="stringliteral">&quot;Type=%s ID=%s CommandName=%s Format=%s Len=%d\n&quot;</span>,</div><div class="line">        type?type:<span class="stringliteral">&quot;&quot;</span>, <span class="keywordtype">id</span>?<span class="keywordtype">id</span>:<span class="stringliteral">&quot;&quot;</span>, commandName?commandName:<span class="stringliteral">&quot;&quot;</span>, format?format:<span class="stringliteral">&quot;&quot;</span>, (<span class="keywordtype">int</span>)payloadSize);</div><div class="line">    fprintf(stdout, <span class="stringliteral">&quot;Payload: %s\n&quot;</span>, payload?(<span class="keywordtype">char</span> *)payload:<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Device developers - add your custom code to process device commands</span></div><div class="line">}</div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9">IOTPRC</a> rc = IOTP_SUCCESS;</div><div class="line"></div><div class="line">    <span class="comment">// Add code to configure and connect the device client</span></div><div class="line"></div><div class="line">    rc = <a class="code" href="iotp__device_8h.html#a77c28a7752929c488f8de1d757faa161">IoTPDevice_setCommandsHandler</a>(device, deviceCommandCallback);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <span class="comment">// User defined code to handle failure, or call APIs to cleanup and exit</span></div><div class="line">    }</div><div class="line">    <span class="keywordtype">char</span> *commandName = <span class="stringliteral">&quot;+&quot;</span>; <span class="comment">// use wildcard subscription</span></div><div class="line">    <span class="keywordtype">char</span> *format = <span class="stringliteral">&quot;+&quot;</span>;      <span class="comment">// use wildcard to receive command in any format. e.g. json, text etc</span></div><div class="line">    rc = <a class="code" href="iotp__device_8h.html#a5c500f40abdc10973c7a55445c59d5dc">IoTPDevice_subscribeToCommands</a>(device, commandName, format);</div><div class="line">    <span class="keywordflow">if</span> ( rc != <a class="code" href="iotp__rc_8h.html#a3687cd953aa67710962875d9196dc2d9a79948a3653fcc5254599100b9aabab88">IOTPRC_SUCCESS</a> ) {</div><div class="line">        <span class="comment">// User defined code to handle failure. Or exit invoke cleanup APIs.</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Add code to send events if required. Refer to &quot;Send Event&quot; section for details.</span></div><div class="line"></div><div class="line">    <span class="comment">// Add calls to cleanup APIs. Refer to &quot;Disconnect and Cleanup&quot; section for details.</span></div><div class="line"></div><div class="line">    <span class="comment">// On exit call cleanup APIs </span></div><div class="line">    <a class="code" href="iotp__device_8h.html#af1c5bceae570ccb81e3a25e27c797313">IoTPDevice_disconnect</a>(device);</div><div class="line">    <a class="code" href="iotp__device_8h.html#a8fa1e11d38b6d38ce4f3a3d35f2623a7">IoTPDevice_destroy</a>(device);</div><div class="line">    <a class="code" href="iotp__config_8h.html#a438e8e030e3adae33ea1b4dc7eab9337">IoTPConfig_clear</a>(config);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">IBM Watson IoT Platform </li>
  </ul>
</div>
</body>
</html>
